<!DOCTYPE html>
<html>
<head>
    <title>Attendance System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .table-success { background-color: #d1e7dd !important; }
        .table-secondary { background-color: #e9ecef !important; }
        th { font-size: 0.9rem; text-align: center; }
        td { font-size: 0.8rem; text-align: center; }
        .table-responsive { overflow-x: auto; }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar navbar-dark bg-dark">
        <div class="container">
            <span class="navbar-brand">Attendance System</span>
        </div>
    </nav>
    
    <!-- Main Content Container -->
    <div class="container mt-4">
        <h2>Attendance for {{ month_name }}</h2>
        
        <!-- Month Navigation -->
        <div class="mb-3">
            {% set prev_month = month - 1 %}
            {% set prev_year = year %}
            {% if prev_month < 1 %}
                {% set prev_month = 12 %}
                {% set prev_year = year - 1 %}
            {% endif %}
            
            {% set next_month = month + 1 %}
            {% set next_year = year %}
            {% if next_month > 12 %}
                {% set next_month = 1 %}
                {% set next_year = year + 1 %}
            {% endif %}
            
            <a href="/?month={{ prev_month }}&year={{ prev_year }}" class="btn btn-secondary btn-sm">← Previous Month</a>
            <a href="/?month={{ next_month }}&year={{ next_year }}" class="btn btn-secondary btn-sm">Next Month →</a>
            <a href="/" class="btn btn-primary btn-sm">Current Month</a>
        </div>
        
        <!-- Attendance Table -->
        <div class="table-responsive">
            <table class="table table-bordered table-sm">
                <thead class="table-dark">
                    <tr>
                        <th>Name</th>
                        <!-- Generate column headers for each day of the month -->
                        {% for day in range(1, num_days + 1) %}
                            <th>{{ day }}</th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody>
                    <!-- Loop through each user and their attendance -->
                    {% for name, user_data in attendance.items() %}
                        <tr>
                            <td><strong>{{ name }}</strong></td>
                            
                            <!-- Loop through each day of the month -->
                            {% for day in range(1, num_days + 1) %}
                                {% set current_date = "{:04d}-{:02d}-{:02d}".format(year, month, day) %}
                                {% set has_attendance = current_date in user_data %}
                                <td class="{{ 'table-success' if has_attendance else 'table-secondary' }}">
                                    <!-- Show clock-in times or dash if no attendance -->
                                    {% if has_attendance %}
                                        {% for time_entry in user_data[current_date] %}
                                            {% if time_entry %}
                                                {{ time_entry.strftime('%H:%M') }}<br>
                                            {% endif %}
                                        {% endfor %}
                                    {% else %}
                                        -
                                    {% endif %}
                                </td>
                            {% endfor %}
                        </tr>
                    {% else %}
                        <tr>
                            <td colspan="{{ num_days + 1 }}" class="text-center text-muted">
                                No users or attendance data found.
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        <!-- Legend -->
        <div class="mt-3">
            <small>
                <span class="badge bg-success">Present</span>
                <span class="badge bg-secondary">Absent</span>
            </small>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>